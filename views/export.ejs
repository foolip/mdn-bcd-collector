<%- contentFor('body') %>
<p><span id="status">Loading page...</span> <a id="link"></a></p>
<p>
  <span class="mdi mdi-download"></span><a href="/api/results">Download results JSON</a><br>
</p>
<script>
function exportGitHub() {
  var status = document.getElementById('status');
  var link = document.getElementById('link');

  var client;
  if ('XMLHttpRequest' in self) {
    client = new XMLHttpRequest();
  } else if ('ActiveXObject' in self) {
    client = new ActiveXObject('Microsoft.XMLHTTP');
  }

  if (!client) {
    status.innerHTML = 'Cannot upload results: XMLHttpRequest is not supported.';
    return;
  }

  client.open('POST', '/api/results/export/github<%- mock ? '?mock=true' : '' %>', true);
  client.send('');
  status.innerHTML = 'Exporting...';
  client.onreadystatechange = function() {
    if (client.readyState == 4) {
      if (client.status >= 200 && client.status <= 299) {
        if (client.responseText == 'DISABLED') {
          status.innerHTML = 'Mock mode; export to GitHub disabled';
          if (status.classList) {
            status.classList.add('warning-notice');
          }
        } else {
          status.innerHTML = 'Exported to';
          link.href = link.innerHTML = client.responseText;
          if (status.classList) {
            status.classList.add('success-notice');
          }
        }
      } else if (client.status == 412) {
        status.innerHTML = 'No results to export';
        if (status.classList) {
          status.classList.add('warning-notice');
        }
      } else {
        status.innerHTML = 'Failed to export: ' + client.responseText;
        if (status.classList) {
          status.classList.add('error-notice');
        }
      }
    }
  }
}
window.onload = exportGitHub;
</script>
